/**
 * Tooltip Dictionary
 *
 * Словарь терминов с простыми объяснениями для non-tech аудитории.
 * Каждый термин содержит:
 * - simple: простое объяснение
 * - example: конкретный пример (опционально)
 * - whyMatters: почему это важно для бизнеса (опционально)
 */

import type { TooltipTerm } from '@/types/ux';

// ===========================================
// Business Metrics
// ===========================================

const METRICS_TERMS: Record<string, TooltipTerm> = {
  mrr: {
    term: 'MRR',
    simple: 'Ежемесячный доход от подписок. Деньги, которые вы стабильно получаете каждый месяц.',
    example: '100 клиентов × 1000₽/мес = 100,000₽ MRR',
    whyMatters: 'Показывает стабильность бизнеса. Инвесторы любят предсказуемый доход.',
  },
  arr: {
    term: 'ARR',
    simple: 'Годовой доход от подписок. MRR × 12 месяцев.',
    example: 'MRR 100,000₽ × 12 = ARR 1,200,000₽',
    whyMatters: 'Используется для оценки стоимости SaaS-бизнеса.',
  },
  churn: {
    term: 'Отток (Churn)',
    simple: 'Процент клиентов, которые перестают платить каждый месяц.',
    example: 'Было 100 клиентов, ушло 5 = отток 5%',
    whyMatters: 'Высокий отток съедает весь рост. Норма для B2B: 3-5%, для B2C: 5-7%.',
  },
  ltv: {
    term: 'LTV',
    simple: 'Сколько денег в среднем приносит один клиент за всё время.',
    example: 'Клиент платит 1000₽/мес и остаётся 12 мес = LTV 12,000₽',
    whyMatters: 'LTV должен быть минимум в 3 раза больше стоимости привлечения (CAC).',
  },
  cac: {
    term: 'CAC',
    simple: 'Сколько стоит привлечь одного платящего клиента.',
    example: 'Потратили 100,000₽ на рекламу, получили 50 клиентов = CAC 2,000₽',
    whyMatters: 'Если CAC > LTV, бизнес теряет деньги на каждом клиенте.',
  },
  conversion: {
    term: 'Конверсия',
    simple: 'Процент людей, которые совершили нужное действие.',
    example: '1000 зашли на сайт, 30 купили = конверсия 3%',
    whyMatters: 'Даже +1% к конверсии может удвоить продажи.',
  },
  retention: {
    term: 'Retention',
    simple: 'Процент клиентов, которые возвращаются и продолжают пользоваться.',
    example: 'Из 100 новых юзеров через месяц остались 40 = retention 40%',
    whyMatters: 'Удержать клиента в 5-7 раз дешевле, чем привлечь нового.',
  },
  growth_rate: {
    term: 'Темп роста',
    simple: 'На сколько процентов вырос показатель за период.',
    example: 'Было 10,000₽ MRR, стало 15,000₽ = рост 50%',
    whyMatters: 'Показывает скорость развития бизнеса.',
  },
};

// ===========================================
// Business Model Terms
// ===========================================

const BUSINESS_TERMS: Record<string, TooltipTerm> = {
  saas: {
    term: 'SaaS',
    simple: 'Программа, за которую платят подписку. Клиент не покупает, а арендует.',
    example: 'Netflix, Spotify, 1C в облаке',
    whyMatters: 'Стабильный доход + высокая оценка бизнеса инвесторами.',
  },
  b2b: {
    term: 'B2B',
    simple: 'Продажа бизнесам, а не обычным людям.',
    example: 'CRM-система для отделов продаж',
    whyMatters: 'Обычно выше чек, дольше цикл продажи, меньше отток.',
  },
  b2c: {
    term: 'B2C',
    simple: 'Продажа обычным людям (конечным потребителям).',
    example: 'Приложение для фитнеса, онлайн-курсы',
    whyMatters: 'Больше клиентов, меньше чек, выше отток.',
  },
  freemium: {
    term: 'Freemium',
    simple: 'Базовая версия бесплатно, за расширенные функции — платно.',
    example: 'Spotify: бесплатно с рекламой, Premium без рекламы',
    whyMatters: 'Легче привлечь юзеров, но нужно конвертировать в платящих.',
  },
  marketplace: {
    term: 'Маркетплейс',
    simple: 'Площадка, где продавцы встречаются с покупателями.',
    example: 'Wildberries, Авито, Airbnb',
    whyMatters: 'Нужно растить обе стороны одновременно (курица и яйцо).',
  },
  mvp: {
    term: 'MVP',
    simple: 'Минимальный продукт, который уже можно показать клиентам.',
    example: 'Лендинг + форма заявки вместо полного приложения',
    whyMatters: 'Позволяет проверить идею до больших вложений.',
  },
  pmf: {
    term: 'Product-Market Fit',
    simple: 'Когда продукт реально нужен рынку и люди готовы платить.',
    example: 'Юзеры сами рекомендуют, отток низкий, продажи растут',
    whyMatters: 'Без PMF масштабирование бессмысленно — будете сливать деньги.',
  },
  unit_economics: {
    term: 'Unit-экономика',
    simple: 'Сколько зарабатываете и тратите на одного клиента.',
    example: 'LTV 10,000₽, CAC 3,000₽ = прибыль 7,000₽ с клиента',
    whyMatters: 'Если unit-экономика отрицательная, рост только увеличит убытки.',
  },
};

// ===========================================
// Business Canvas Terms
// ===========================================

const CANVAS_TERMS: Record<string, TooltipTerm> = {
  value_proposition: {
    term: 'Ценностное предложение',
    simple: 'Почему клиент должен выбрать именно вас, а не конкурентов.',
    example: '"Доставка еды за 15 минут" — конкретная ценность',
    whyMatters: 'Без чёткого ответа на "почему вы?" продажи будут буксовать.',
  },
  customer_segments: {
    term: 'Сегменты клиентов',
    simple: 'Группы людей с похожими потребностями, которым вы продаёте.',
    example: 'Мамы с детьми 3-7 лет, живущие в Москве',
    whyMatters: 'Нельзя быть для всех. Узкий сегмент = точный маркетинг.',
  },
  channels: {
    term: 'Каналы',
    simple: 'Как клиенты узнают о вас и как покупают.',
    example: 'Instagram, Яндекс.Директ, сарафанное радио',
    whyMatters: 'Нужно найти каналы, где ваши клиенты уже есть.',
  },
  revenue_streams: {
    term: 'Потоки доходов',
    simple: 'Все способы, которыми вы зарабатываете деньги.',
    example: 'Подписка + консультации + партнёрская программа',
    whyMatters: 'Несколько источников дохода = устойчивость.',
  },
  key_resources: {
    term: 'Ключевые ресурсы',
    simple: 'Что обязательно нужно для работы бизнеса.',
    example: 'Команда разработки, серверы, база клиентов',
    whyMatters: 'Понимание ресурсов помогает планировать рост.',
  },
  key_activities: {
    term: 'Ключевые активности',
    simple: 'Главные действия, без которых бизнес не работает.',
    example: 'Разработка продукта, поддержка клиентов, маркетинг',
    whyMatters: 'На это нужно тратить основное время и деньги.',
  },
  key_partners: {
    term: 'Ключевые партнёры',
    simple: 'Компании и люди, без которых бизнес не может работать.',
    example: 'Поставщики, платёжные системы, курьерские службы',
    whyMatters: 'Хорошие партнёры = конкурентное преимущество.',
  },
  cost_structure: {
    term: 'Структура затрат',
    simple: 'На что уходят деньги в бизнесе.',
    example: 'Зарплаты 60%, маркетинг 20%, серверы 10%, прочее 10%',
    whyMatters: 'Контроль затрат = путь к прибыльности.',
  },
};

// ===========================================
// Gap & Analysis Terms
// ===========================================

const ANALYSIS_TERMS: Record<string, TooltipTerm> = {
  gap: {
    term: 'Разрыв (Gap)',
    simple: 'Разница между тем, что нужно бизнесу, и тем, что есть сейчас.',
    example: 'Нужна оплата на сайте, но её ещё нет = gap в монетизации',
    whyMatters: 'Закрытие разрывов = рост бизнеса.',
  },
  critical_gap: {
    term: 'Критический разрыв',
    simple: 'Проблема, которая сильно мешает бизнесу прямо сейчас.',
    example: 'Нет способа принимать оплату = клиенты не могут заплатить',
    whyMatters: 'Решать в первую очередь!',
  },
  warning_gap: {
    term: 'Предупреждение',
    simple: 'Проблема средней важности. Не критично, но лучше исправить.',
    example: 'Нет аналитики — не видите, откуда приходят клиенты',
    whyMatters: 'Если игнорировать, может перерасти в критическую проблему.',
  },
  info_gap: {
    term: 'Информация',
    simple: 'Небольшое улучшение, которое сделает продукт лучше.',
    example: 'Можно добавить тёмную тему для удобства',
    whyMatters: 'Полировка продукта после решения важных проблем.',
  },
  alignment_score: {
    term: 'Скор соответствия',
    simple: 'Оценка, насколько продукт соответствует целям бизнеса (0-100).',
    example: '75 баллов = хорошо, но есть что улучшить',
    whyMatters: 'Показывает общую картину здоровья бизнеса.',
  },
  verdict: {
    term: 'Вердикт',
    simple: 'Общая оценка состояния: всё хорошо / нужны улучшения / нужны изменения.',
    example: 'ON_TRACK = двигаетесь в правильном направлении',
    whyMatters: 'Быстрое понимание, требуются ли срочные действия.',
  },
  business_stage: {
    term: 'Стадия бизнеса',
    simple: 'На каком этапе развития находится ваш бизнес.',
    example: 'Idea → Building → Early Traction → Growing → Scaling',
    whyMatters: 'Разные стадии требуют разных действий.',
  },
};

// ===========================================
// Technical Terms (simplified)
// ===========================================

const TECH_TERMS: Record<string, TooltipTerm> = {
  api: {
    term: 'API',
    simple: 'Способ для программ общаться друг с другом.',
    example: 'Ваш сайт через API получает данные о погоде',
    whyMatters: 'Позволяет интегрироваться с другими сервисами.',
  },
  analytics: {
    term: 'Аналитика',
    simple: 'Сбор данных о том, как люди используют ваш продукт.',
    example: 'Сколько людей зашло, откуда, что делали на сайте',
    whyMatters: 'Без данных вы принимаете решения вслепую.',
  },
  deployment: {
    term: 'Деплой',
    simple: 'Публикация продукта в интернете, чтобы клиенты могли им пользоваться.',
    example: 'Сайт залит на хостинг и доступен по адресу',
    whyMatters: 'Пока не задеплоено — клиенты не видят продукт.',
  },
  tech_stack: {
    term: 'Технологии',
    simple: 'Набор инструментов, на которых построен продукт.',
    example: 'React, Node.js, PostgreSQL',
    whyMatters: 'Влияет на скорость разработки и стоимость поддержки.',
  },
  security: {
    term: 'Безопасность',
    simple: 'Защита данных пользователей и бизнеса от взлома.',
    example: 'Шифрование паролей, защита от SQL-инъекций',
    whyMatters: 'Утечка данных = потеря доверия и штрафы.',
  },
  scalability: {
    term: 'Масштабируемость',
    simple: 'Способность продукта работать при росте нагрузки.',
    example: 'Сайт работает и при 100, и при 100,000 посетителей',
    whyMatters: 'Без этого рост бизнеса упрётся в технические ограничения.',
  },
  // Additional tech terms
  cdn: {
    term: 'CDN',
    simple: 'Сеть серверов по всему миру, которая ускоряет загрузку сайта.',
    example: 'Картинки загружаются с ближайшего сервера, а не из США',
    whyMatters: 'Быстрый сайт = меньше отказов, лучше позиции в поиске.',
  },
  redis: {
    term: 'Redis',
    simple: 'Очень быстрая база данных для временного хранения.',
    example: 'Хранит данные сессий, чтобы не лезть в основную базу',
    whyMatters: 'Ускоряет сайт в 10-100 раз для часто запрашиваемых данных.',
  },
  webhook: {
    term: 'Webhook',
    simple: 'Автоматическое уведомление от другого сервиса, когда что-то произошло.',
    example: 'Stripe присылает webhook, когда клиент оплатил',
    whyMatters: 'Позволяет реагировать на события в реальном времени.',
  },
  cicd: {
    term: 'CI/CD',
    simple: 'Автоматическая проверка и публикация кода при каждом изменении.',
    example: 'Пушите код → автотесты → автоматический деплой на сайт',
    whyMatters: 'Меньше ошибок, быстрее обновления, меньше ручной работы.',
  },
  ssl: {
    term: 'SSL/HTTPS',
    simple: 'Защита соединения между пользователем и сайтом (замочек в браузере).',
    example: 'Данные карты шифруются при отправке',
    whyMatters: 'Без SSL браузеры показывают "небезопасно", клиенты уходят.',
  },
  seo: {
    term: 'SEO',
    simple: 'Оптимизация сайта, чтобы он появлялся выше в поиске Google/Яндекс.',
    example: 'Правильные заголовки, быстрая загрузка, полезный контент',
    whyMatters: 'Бесплатный трафик из поиска — один из лучших каналов.',
  },
  stripe: {
    term: 'Stripe',
    simple: 'Популярный сервис для приёма платежей картами.',
    example: 'Клиент вводит карту на вашем сайте, деньги приходят на счёт',
    whyMatters: 'Легко подключить, работает по всему миру.',
  },
  mixpanel: {
    term: 'Mixpanel',
    simple: 'Сервис аналитики, который показывает, что делают пользователи.',
    example: 'Сколько людей дошло от регистрации до покупки',
    whyMatters: 'Помогает найти, где пользователи "отваливаются".',
  },
  pwa: {
    term: 'PWA',
    simple: 'Сайт, который работает как приложение на телефоне.',
    example: 'Можно добавить на домашний экран, работает офлайн',
    whyMatters: 'Удобство мобильного приложения без затрат на разработку.',
  },
  utm: {
    term: 'UTM-метки',
    simple: 'Специальные параметры в ссылке для отслеживания источника трафика.',
    example: 'site.ru?utm_source=youtube — видно, что пришёл с YouTube',
    whyMatters: 'Понимаете, какая реклама работает, а какая нет.',
  },
  gdpr: {
    term: 'GDPR',
    simple: 'Европейский закон о защите персональных данных.',
    example: 'Нужно спрашивать согласие на cookies, давать удалить данные',
    whyMatters: 'Штрафы до 20 млн € за нарушение.',
  },
  onboarding: {
    term: 'Онбординг',
    simple: 'Процесс знакомства нового пользователя с продуктом.',
    example: 'Приветственные экраны, подсказки, первые шаги',
    whyMatters: 'Хороший онбординг увеличивает конверсию в 2-3 раза.',
  },
};

// ===========================================
// Stage Terms
// ===========================================

const STAGE_TERMS: Record<string, TooltipTerm> = {
  idea: {
    term: 'Идея',
    simple: 'Есть идея, но продукта ещё нет или он совсем базовый.',
    example: 'Описание в заметках, возможно простой прототип',
    whyMatters: 'Главное — проверить, нужно ли это кому-то.',
  },
  building: {
    term: 'Разработка',
    simple: 'Активно строите продукт, первые пользователи тестируют.',
    example: 'MVP готов, собираете обратную связь',
    whyMatters: 'Фокус на качестве продукта и первых отзывах.',
  },
  early_traction: {
    term: 'Первые успехи',
    simple: 'Есть первые платящие клиенты, продукт работает.',
    example: '10-100 платящих клиентов, понятно, что нужно рынку',
    whyMatters: 'Время оптимизировать и готовиться к росту.',
  },
  growing: {
    term: 'Рост',
    simple: 'Бизнес растёт, процессы налаживаются.',
    example: '100-1000 клиентов, команда расширяется',
    whyMatters: 'Фокус на масштабировании того, что работает.',
  },
  scaling: {
    term: 'Масштабирование',
    simple: 'Большой бизнес, агрессивный рост.',
    example: '1000+ клиентов, несколько команд, инвестиции',
    whyMatters: 'Оптимизация процессов и автоматизация.',
  },
};

// ===========================================
// Category Terms
// ===========================================

const CATEGORY_TERMS: Record<string, TooltipTerm> = {
  monetization: {
    term: 'Монетизация',
    simple: 'Всё, что связано с получением денег от клиентов.',
    example: 'Платёжная система, тарифы, биллинг',
    whyMatters: 'Нет монетизации = нет бизнеса.',
  },
  growth: {
    term: 'Рост',
    simple: 'Привлечение новых клиентов и увеличение дохода.',
    example: 'Маркетинг, реферальная программа, SEO',
    whyMatters: 'Без роста бизнес стагнирует.',
  },
  ux: {
    term: 'Пользовательский опыт',
    simple: 'Насколько удобно и приятно пользоваться продуктом.',
    example: 'Простая регистрация, понятный интерфейс',
    whyMatters: 'Плохой UX = пользователи уходят к конкурентам.',
  },
  infrastructure: {
    term: 'Инфраструктура',
    simple: 'Техническая основа: серверы, базы данных, хостинг.',
    example: 'Где крутится сайт, как хранятся данные',
    whyMatters: 'Нестабильная инфраструктура = падения и потеря клиентов.',
  },
  marketing: {
    term: 'Маркетинг',
    simple: 'Как вы рассказываете о продукте и привлекаете клиентов.',
    example: 'Реклама, контент, социальные сети',
    whyMatters: 'Даже лучший продукт не продаст себя сам.',
  },
  testing: {
    term: 'Тестирование',
    simple: 'Проверка, что продукт работает без ошибок.',
    example: 'Автоматические тесты, ручная проверка',
    whyMatters: 'Баги отпугивают пользователей и портят репутацию.',
  },
  documentation: {
    term: 'Документация',
    simple: 'Описание того, как всё работает и как этим пользоваться.',
    example: 'Инструкции для пользователей, база знаний',
    whyMatters: 'Экономит время на поддержку и обучение.',
  },
};

// ===========================================
// Export Combined Dictionary
// ===========================================

export const TERMS_DICTIONARY: Record<string, TooltipTerm> = {
  ...METRICS_TERMS,
  ...BUSINESS_TERMS,
  ...CANVAS_TERMS,
  ...ANALYSIS_TERMS,
  ...TECH_TERMS,
  ...STAGE_TERMS,
  ...CATEGORY_TERMS,
};

// ===========================================
// Helper Functions
// ===========================================

/**
 * Get term explanation by key
 */
export function getTerm(key: string): TooltipTerm | undefined {
  return TERMS_DICTIONARY[key.toLowerCase()];
}

/**
 * Check if term exists in dictionary
 */
export function hasTerm(key: string): boolean {
  return key.toLowerCase() in TERMS_DICTIONARY;
}

/**
 * Get all terms for a category
 */
export function getTermsByCategory(category: 'metrics' | 'business' | 'canvas' | 'analysis' | 'tech' | 'stage' | 'category'): Record<string, TooltipTerm> {
  switch (category) {
    case 'metrics':
      return METRICS_TERMS;
    case 'business':
      return BUSINESS_TERMS;
    case 'canvas':
      return CANVAS_TERMS;
    case 'analysis':
      return ANALYSIS_TERMS;
    case 'tech':
      return TECH_TERMS;
    case 'stage':
      return STAGE_TERMS;
    case 'category':
      return CATEGORY_TERMS;
    default:
      return {};
  }
}

/**
 * Search terms by query
 */
export function searchTerms(query: string): TooltipTerm[] {
  const lowerQuery = query.toLowerCase();
  return Object.values(TERMS_DICTIONARY).filter(
    (term) =>
      term.term.toLowerCase().includes(lowerQuery) ||
      term.simple.toLowerCase().includes(lowerQuery)
  );
}
